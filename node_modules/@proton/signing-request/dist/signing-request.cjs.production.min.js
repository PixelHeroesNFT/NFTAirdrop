"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("@proton/js"),r=(e=require("fast-sha256"))&&"object"==typeof e&&"default"in e?e.default:e;function n(e,t,r,n,a,i,o){try{var s=e[i](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,a)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(a,i){var o=e.apply(t,r);function s(e){n(o,a,i,s,c,"next",e)}function c(e){n(o,a,i,s,c,"throw",e)}s(void 0)}))}}function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}function c(e,t){return e(t={exports:{}},t.exports),t.exports}for(var u=c((function(e){var t=function(e){var t=Object.prototype,r=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var a=Object.create((t&&t.prototype instanceof l?t:l).prototype),i=new k(n||[]);return a._invoke=function(e,t,r){var n="suspendedStart";return function(a,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw i;return{value:void 0,done:!0}}for(r.method=a,r.arg=i;;){var o=r.delegate;if(o){var s=_(o,r);if(s){if(s===f)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(e,r,i),a}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var f={};function l(){}function h(){}function d(){}var p={};p[a]=function(){return this};var y=Object.getPrototypeOf,v=y&&y(y(S([])));v&&v!==t&&r.call(v,a)&&(p=v);var m=d.prototype=l.prototype=Object.create(p);function g(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var n;this._invoke=function(a,i){function o(){return new t((function(n,o){!function n(a,i,o,s){var c=u(e[a],e,i);if("throw"!==c.type){var f=c.arg,l=f.value;return l&&"object"==typeof l&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(l).then((function(e){f.value=e,o(f)}),(function(e){return n("throw",e,o,s)}))}s(c.arg)}(a,i,n,o)}))}return n=n?n.then(o,o):o()}}function _(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,f;var a=n.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function S(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return h.prototype=m.constructor=d,d.constructor=h,h.displayName=s(d,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,o,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},g(b.prototype),b.prototype[i]=function(){return this},e.AsyncIterator=b,e.async=function(t,r,n,a,i){void 0===i&&(i=Promise);var o=new b(c(t,r,n,a),i);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},g(m),s(m,o,"Generator"),m[a]=function(){return this},m.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=S,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return o.type="throw",o.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;w(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}})),f={version:"eosio::abi/1.1",types:[{new_type_name:"account_name",type:"name"},{new_type_name:"action_name",type:"name"},{new_type_name:"permission_name",type:"name"},{new_type_name:"chain_alias",type:"uint8"},{new_type_name:"chain_id",type:"checksum256"},{new_type_name:"request_flags",type:"uint8"}],structs:[{name:"permission_level",fields:[{name:"actor",type:"account_name"},{name:"permission",type:"permission_name"}]},{name:"action",fields:[{name:"account",type:"account_name"},{name:"name",type:"action_name"},{name:"authorization",type:"permission_level[]"},{name:"data",type:"bytes"}]},{name:"extension",fields:[{name:"type",type:"uint16"},{name:"data",type:"bytes"}]},{name:"transaction_header",fields:[{name:"expiration",type:"time_point_sec"},{name:"ref_block_num",type:"uint16"},{name:"ref_block_prefix",type:"uint32"},{name:"max_net_usage_words",type:"varuint32"},{name:"max_cpu_usage_ms",type:"uint8"},{name:"delay_sec",type:"varuint32"}]},{name:"transaction",base:"transaction_header",fields:[{name:"context_free_actions",type:"action[]"},{name:"actions",type:"action[]"},{name:"transaction_extensions",type:"extension[]"}]},{name:"info_pair",fields:[{name:"key",type:"string"},{name:"value",type:"bytes"}]},{name:"signing_request",fields:[{name:"chain_id",type:"variant_id"},{name:"req",type:"variant_req"},{name:"flags",type:"request_flags"},{name:"callback",type:"string"},{name:"info",type:"info_pair[]"}]},{name:"identity",fields:[{name:"permission",type:"permission_level?"}]},{name:"request_signature",fields:[{name:"signer",type:"name"},{name:"signature",type:"signature"}]}],variants:[{name:"variant_id",types:["chain_alias","chain_id"]},{name:"variant_req",types:["action","action[]","transaction","identity"]}],actions:[{name:"identity",type:"identity"}]},l={__proto__:null,RequestFlagsNone:0,RequestFlagsBroadcast:1,RequestFlagsBackground:2,data:f},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",d=new Uint8Array(256),p=0;p<64;p++)d[h.charCodeAt(p)]=p;require("fast-text-encoding");var y,v=new TextEncoder,m=new TextDecoder,g=t.Serialize.getTypesFromAbi(t.Serialize.createInitialTypes(),f);(y=exports.ChainName||(exports.ChainName={}))[y.UNKNOWN=0]="UNKNOWN",y[y.EOS=1]="EOS",y[y.TELOS=2]="TELOS",y[y.JUNGLE=3]="JUNGLE",y[y.KYLIN=4]="KYLIN",y[y.WORBLI=5]="WORBLI",y[y.BOS=6]="BOS",y[y.MEETONE=7]="MEETONE",y[y.INSIGHTS=8]="INSIGHTS",y[y.BEOS=9]="BEOS",y[y.WAX=10]="WAX",y[y.PROTON=11]="PROTON",y[y.FIO=12]="FIO";var b=new Map([[exports.ChainName.EOS,"aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906"],[exports.ChainName.TELOS,"4667b205c6838ef70ff7988f6e8257e8be0e1284a2f59699054a018f743b1d11"],[exports.ChainName.JUNGLE,"e70aaab8997e1dfce58fbfac80cbbb8fecec7b99cf982a9444273cbc64c41473"],[exports.ChainName.KYLIN,"5fff1dae8dc8e2fc4d5b23b2c7665c97f9e9d8edf2b6485a86ba311c25639191"],[exports.ChainName.WORBLI,"73647cde120091e0a4b85bced2f3cfdb3041e266cbbe95cee59b73235a1b3b6f"],[exports.ChainName.BOS,"d5a3d18fbb3c084e3b1f3fa98c21014b5f3db536cc15d08f9f6479517c6a3d86"],[exports.ChainName.MEETONE,"cfe6486a83bad4962f232d48003b1824ab5665c36778141034d75e57b956e422"],[exports.ChainName.INSIGHTS,"b042025541e25a472bffde2d62edd457b7e70cee943412b1ea0f044f88591664"],[exports.ChainName.BEOS,"b912d19a6abd2b1b05611ae5be473355d64d95aeff0c09bedc8c166cd6468fe4"],[exports.ChainName.WAX,"1064487b3cd1a897ce03ae5b6a865651747e2e152090f99c1d19d44e01aea5a4"],[exports.ChainName.PROTON,"384da888112027f0321850a169f737c33e53b388aad48b5adace4bab97f437e0"],[exports.ChainName.FIO,"21dcae42c0182200e93f954a074011f9048a7624c6fe81d3c9541a614a88bd1c"]]),_={actor:"............1",permission:"............2"},x=function(){function e(e,t,r,n,a,i){if(this.scheme="esr",0!=(1&t.flags)&&"identity"===t.req[0])throw new Error("Invalid request (identity request cannot be broadcast)");if(0==(1&t.flags)&&0===t.callback.length)throw new Error("Invalid request (nothing to do, no broadcast or callback set)");this.version=e,this.data=t,this.zlib=r,this.abiProvider=n,this.signature=a,this.scheme=i||this.scheme}e.create=function(){var t=a(u.mark((function t(r,n){var a,i,o,s,c,f;return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===n&&(n={}),a={},i=function(e){return S(e,n.abiProvider)},void 0===r.identity){t.next=7;break}a.req=["identity",r.identity],t.next=45;break;case 7:if(!r.action||r.actions||r.transaction){t.next=14;break}return t.next=10,i(r.action);case 10:t.t0=t.sent,a.req=["action",t.t0],t.next=45;break;case 14:if(!r.actions||r.action||r.transaction){t.next=28;break}if(1!==r.actions.length){t.next=22;break}return t.next=18,i(r.actions[0]);case 18:t.t1=t.sent,a.req=["action",t.t1],t.next=26;break;case 22:return t.next=24,Promise.all(r.actions.map(i));case 24:t.t2=t.sent,a.req=["action[]",t.t2];case 26:t.next=45;break;case 28:if(!r.transaction||r.action||r.actions){t.next=44;break}return void 0===(o=r.transaction).expiration&&(o.expiration="1970-01-01T00:00:00.000"),void 0===o.ref_block_num&&(o.ref_block_num=0),void 0===o.ref_block_prefix&&(o.ref_block_prefix=0),void 0===o.context_free_actions&&(o.context_free_actions=[]),void 0===o.transaction_extensions&&(o.transaction_extensions=[]),void 0===o.delay_sec&&(o.delay_sec=0),void 0===o.max_cpu_usage_ms&&(o.max_cpu_usage_ms=0),void 0===o.max_net_usage_words&&(o.max_net_usage_words=0),t.next=40,Promise.all(o.actions.map(i));case 40:o.actions=t.sent,a.req=["transaction",o],t.next=45;break;case 44:throw new TypeError("Invalid arguments: Must have exactly one of action, actions or transaction");case 45:if(a.chain_id=N(r.chainId),a.flags=0,(void 0===r.broadcast||r.broadcast)&&(a.flags|=1),"string"==typeof r.callback?a.callback=r.callback:"object"==typeof r.callback?(a.callback=r.callback.url,r.callback.background&&(a.flags|=2)):a.callback="",a.info=[],"object"!=typeof r.info){t.next=63;break}t.t3=u.keys(r.info);case 53:if((t.t4=t.t3()).done){t.next=63;break}if(!r.info.hasOwnProperty(s=t.t4.value)){t.next=61;break}if(c=r.info[s],"string"==typeof s){t.next=59;break}throw new Error("Invalid info dict, keys must be strings");case 59:"string"==typeof c&&(c=v.encode(c)),a.info.push({key:s,value:c});case 61:t.next=53;break;case 63:return f=new e(2,a,n.zlib,n.abiProvider,void 0,n.scheme),n.signatureProvider&&f.sign(n.signatureProvider),t.abrupt("return",f);case 66:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),e.identity=function(e,t){void 0===t&&(t={});var r={actor:e.account||"............1",permission:e.permission||"............2"};return"............1"===r.actor&&"............2"===r.permission&&(r=null),this.create({identity:{permission:r},broadcast:!1,callback:e.callback,info:e.info},t)},e.fromTransaction=function(r,n,a){void 0===a&&(a={}),"string"!=typeof r&&(r=t.Serialize.arrayToHex(r)),"string"==typeof n&&(n=t.Serialize.hexToUint8Array(n));var i=new t.Serialize.SerialBuffer;i.push(2);var o=N(r);return"chain_alias"===o[0]?(i.push(0),i.push(o[1])):(i.push(1),i.pushArray(t.Serialize.hexToUint8Array(o[1]))),i.push(2),i.pushArray(n),i.push(1),i.push(0),i.push(0),e.fromData(i.asUint8Array(),a)},e.from=function(t,r){if(void 0===r&&(r={}),"string"!=typeof t)throw new Error("Invalid request uri");var n=t.split(":"),a=n[0],i=n[1];if(a!==(r.scheme||"esr")&&a!=="web+"+(r.scheme||"esr"))throw new Error("Invalid scheme");var o=function(e){for(var t,r,n,a,i=new Uint8Array(.75*e.length),o=0,s=0;s<e.length;s+=4)t=d[e.charCodeAt(s)],r=d[e.charCodeAt(s+1)],n=d[e.charCodeAt(s+2)],a=d[e.charCodeAt(s+3)],i[o++]=t<<2|r>>4,i[o++]=(15&r)<<4|n>>2,i[o++]=(3&n)<<6|63&a;return i}(i.startsWith("//")?i.slice(2):i);return e.fromData(o,r)},e.fromData=function(r,n){void 0===n&&(n={});var a=r[0],i=-129&a;if(2!==i)throw new Error("Unsupported protocol version");var o=r.slice(1);if(0!=(128&a)){if(!n.zlib)throw new Error("Compressed URI needs zlib");o=n.zlib.inflateRaw(o)}var s,c=new t.Serialize.SerialBuffer({array:o}),u=e.type.deserialize(c);return c.haveReadData()&&(s=g.get("request_signature").deserialize(c)),new e(i,u,n.zlib,n.abiProvider,s,n.scheme)};var n=e.prototype;return n.sign=function(e){var r=this.getSignatureDigest();this.signature=e.sign(t.Serialize.arrayToHex(r))},n.getSignatureDigest=function(){var e=new t.Serialize.SerialBuffer;return e.pushArray([this.version,114,101,113,117,101,115,116]),e.pushArray(this.getData()),r(e.asUint8Array())},n.setSignature=function(e,t){this.signature={signer:e,signature:t}},n.setCallback=function(e,t){this.data.callback=e,t?this.data.flags|=2:this.data.flags&=-3},n.setBroadcast=function(e){e?this.data.flags|=1:this.data.flags&=-2},n.encode=function(e,t){var r=void 0!==e?e:void 0!==this.zlib;if(r&&void 0===this.zlib)throw new Error("Need zlib to compress");var n=this.version,a=this.getData(),i=this.getSignatureData(),o=new Uint8Array(a.byteLength+i.byteLength);if(o.set(a,0),o.set(i,a.byteLength),r){var s=this.zlib.deflateRaw(o);o.byteLength>s.byteLength&&(n|=128,o=s)}var c=new Uint8Array(1+o.byteLength);c[0]=n,c.set(o,1);var u=this.scheme+":";return!1!==t&&(u+="//"),u+function(e){for(var t,r=e.byteLength,n=r%3,a=r-n,i=[],o=0;o<a;o+=3)i.push(h[(16515072&(t=e[o]<<16|e[o+1]<<8|e[o+2]))>>18]+h[(258048&t)>>12]+h[(4032&t)>>6]+h[63&t]);return 1===n?i.push(h[(252&(t=e[a]))>>2]+h[(3&t)<<4]):2===n&&i.push(h[(64512&(t=e[a]<<8|e[a+1]))>>10]+h[(1008&t)>>4]+h[(15&t)<<2]),i.join("")}(c)},n.getData=function(){var r=new t.Serialize.SerialBuffer;return e.type.serialize(r,this.data),r.asUint8Array()},n.getSignatureData=function(){if(!this.signature)return new Uint8Array(0);var e=new t.Serialize.SerialBuffer;return g.get("request_signature").serialize(e,this.signature),e.asUint8Array()},n.getRequiredAbis=function(){return this.getRawActions().filter((function(e){return!A(e)})).map((function(e){return e.account})).filter((function(e,t,r){return r.indexOf(e)===t}))},n.requiresTapos=function(){var e=this.getRawTransaction();return!this.isIdentity()&&!O(e)},n.fetchAbis=function(){var e=a(u.mark((function e(t){var r,n;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t||this.abiProvider){e.next=3;break}throw new Error("Missing ABI provider");case 3:return n=new Map,e.next=6,Promise.all(this.getRequiredAbis().map(function(){var e=a(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=n,e.t1=t,e.next=4,r.getAbi(t);case 4:e.t2=e.sent,e.t0.set.call(e.t0,e.t1,e.t2);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.resolveActions=function(e,r){return this.getRawActions().map((function(n){var a;if(!(a=A(n)?f:e.get(n.account)))throw new Error("Missing ABI definition for "+n.account);var i=k(a);r&&(i.types.get("name").deserialize=function(e){var t=e.getName();return"............1"===t?r.actor:"............2"===t?r.permission:t});var o=t.Serialize.deserializeAction(i,n.account,n.name,n.authorization,n.data);return r&&(o.authorization=o.authorization.map((function(e){var t=e.actor,n=e.permission;return"............1"===t&&(t=r.actor),"............2"===n&&(n=r.permission),"............1"===n&&(n=r.permission),{actor:t,permission:n}}))),o}))},n.resolveTransaction=function(e,r,n){void 0===n&&(n={});var a=this.getRawTransaction();if(!this.isIdentity()&&!O(a))if(void 0!==n.expiration&&void 0!==n.ref_block_num&&void 0!==n.ref_block_prefix)a.expiration=n.expiration,a.ref_block_num=n.ref_block_num,a.ref_block_prefix=n.ref_block_prefix;else{if(void 0===n.block_num||void 0===n.ref_block_prefix||void 0===n.timestamp)throw new Error("Invalid transaction context, need either a reference block or explicit TAPoS values");var o=t.Serialize.transactionHeader(n,void 0!==n.expire_seconds?n.expire_seconds:60);a.expiration=o.expiration,a.ref_block_num=o.ref_block_num,a.ref_block_prefix=o.ref_block_prefix}return i({},a,{actions:this.resolveActions(e,r)})},n.resolve=function(r,n,a){void 0===a&&(a={});var o=this.resolveTransaction(r,n,a),s=new t.Serialize.SerialBuffer,c=o.actions.map((function(e){var n;if(!(n=A(e)?f:r.get(e.account)))throw new Error("Missing ABI definition for "+e.account);var a=k(n);return t.Serialize.serializeAction(a,e.account,e.name,e.authorization,e.data)}));e.transactionType.serialize(s,i({},o,{actions:c}));var u=s.asUint8Array();return new w(this,n,o,u)},n.getScheme=function(){return this.scheme},n.getChainId=function(){var e=this.data.chain_id;switch(e[0]){case"chain_id":return e[1];case"chain_alias":if(b.has(e[1]))return b.get(e[1]);throw new Error("Unknown chain id alias");default:throw new Error("Invalid signing request data")}},n.getRawActions=function(){var r=this.data.req;switch(r[0]){case"action":return[r[1]];case"action[]":return r[1];case"identity":var n="0101000000000000000200000000000000",a=[_];if(r[1].permission){var i=new t.Serialize.SerialBuffer;e.idType.serialize(i,r[1]),n=t.Serialize.arrayToHex(i.asUint8Array()),a=[r[1].permission]}return[{account:"",name:"identity",authorization:a,data:n}];case"transaction":return r[1].actions;default:throw new Error("Invalid signing request data")}},n.getRawTransaction=function(){var e=this.data.req;switch(e[0]){case"transaction":return e[1];case"action":case"action[]":case"identity":return{actions:this.getRawActions(),context_free_actions:[],transaction_extensions:[],expiration:"1970-01-01T00:00:00.000",ref_block_num:0,ref_block_prefix:0,max_cpu_usage_ms:0,max_net_usage_words:0,delay_sec:0};default:throw new Error("Invalid signing request data")}},n.isIdentity=function(){return"identity"===this.data.req[0]},n.shouldBroadcast=function(){return!this.isIdentity()&&0!=(1&this.data.flags)},n.getIdentity=function(){if("identity"===this.data.req[0]&&this.data.req[1].permission){var e=this.data.req[1].permission.actor;return"............1"===e?null:e}return null},n.getIdentityPermission=function(){if("identity"===this.data.req[0]&&this.data.req[1].permission){var e=this.data.req[1].permission.permission;return"............1"===e?null:e}return null},n.getRawInfo=function(){for(var e,r={},n=s(this.data.info);!(e=n()).done;){var a=e.value,i=a.value;r[a.key]="string"==typeof i?t.Serialize.hexToUint8Array(i):i}return r},n.getInfo=function(){for(var e={},t=this.getRawInfo(),r=0,n=Object.keys(t);r<n.length;r++){var a=n[r];e[a]=m.decode(t[a])}return e},n.setInfoKey=function(e,t){var r,n=this.data.info.find((function(t){return t.key===e}));switch(typeof t){case"string":r=v.encode(t);break;case"boolean":r=new Uint8Array([t?1:0]);break;default:throw new TypeError("Invalid value type, expected string or boolean.")}n?n.value=r:this.data.info.push(n={key:e,value:r})},n.clone=function(){var t;this.signature&&(t=JSON.parse(JSON.stringify(this.signature)));var r=JSON.stringify(this.data,(function(e,t){return t instanceof Uint8Array?Array.from(t):t}));return new e(this.version,JSON.parse(r),this.zlib,this.abiProvider,t,this.scheme)},n.toString=function(){return this.encode()},n.toJSON=function(){return this.encode()},e}();x.type=g.get("signing_request"),x.idType=g.get("identity"),x.transactionType=g.get("transaction");var w=function(){function e(e,t,r,n){this.request=e,this.signer=t,this.transaction=r,this.serializedTransaction=n}e.fromPayload=function(){var e=a(u.mark((function e(t,r){var n;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r={}),n=x.from(t.req,r),e.next=4,n.fetchAbis();case 4:return e.abrupt("return",n.resolve(e.sent,{actor:t.sa,permission:t.sp},{ref_block_num:Number(t.rbn),ref_block_prefix:Number(t.rid),expiration:t.ex}));case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();var n=e.prototype;return n.getTransactionId=function(){return t.Serialize.arrayToHex(r(this.serializedTransaction))},n.getCallback=function(e,t){var r=this.request.data,n=r.callback,a=r.flags;if(!n||0===n.length)return null;if(!e||0===e.length)throw new Error("Must have at least one signature to resolve callback");for(var i,o={sig:e[0],tx:this.getTransactionId(),rbn:String(this.transaction.ref_block_num),rid:String(this.transaction.ref_block_prefix),ex:this.transaction.expiration,req:this.request.encode(),sa:this.signer.actor,sp:this.signer.permission},c=s(e.slice(1).entries());!(i=c()).done;){var u=i.value;o["sig"+u[0]]=u[1]}t&&(o.bn=String(t));var f=n.replace(/({{([a-z0-9]+)}})/g,(function(e,t,r){return o[r]||""}));return{background:0!=(2&a),payload:o,url:f}},e}();function k(e){for(var r,n=t.Serialize.getTypesFromAbi(t.Serialize.createInitialTypes(),e),a=new Map,i=s(e.actions);!(r=i()).done;){var o=r.value;a.set(o.name,t.Serialize.getType(n,o.type))}return{types:n,actions:a}}function S(e,t){return E.apply(this,arguments)}function E(){return(E=a(u.mark((function e(r,n){var a,i;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof r.data){e.next=2;break}return e.abrupt("return",r);case 2:if(!A(r)){e.next=6;break}a=f,e.next=13;break;case 6:if(!n){e.next=12;break}return e.next=9,n.getAbi(r.account);case 9:a=e.sent,e.next=13;break;case 12:throw new Error("Missing abi provider");case 13:return i=k(a),e.abrupt("return",t.Serialize.serializeAction(i,r.account,r.name,r.authorization,r.data));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){if(e||(e=exports.ChainName.EOS),"number"==typeof e)return["chain_alias",e];var t=T(e);return t!==exports.ChainName.UNKNOWN?["chain_alias",t]:["chain_id",e]}function A(e){return""===e.account&&"identity"===e.name}function O(e){return!("1970-01-01T00:00:00.000"===e.expiration&&0===e.ref_block_num&&0===e.ref_block_prefix)}function T(e){e=e.toLowerCase();for(var t=s(b);!t().done;);return exports.ChainName.UNKNOWN}exports.PlaceholderAuth=_,exports.PlaceholderName="............1",exports.PlaceholderPermission="............2",exports.ResolvedSigningRequest=w,exports.SigningRequest=x,exports.abi=l,exports.idToName=T,exports.nameToId=function(e){return b.get(e)||"0000000000000000000000000000000000000000000000000000000000000000"};
//# sourceMappingURL=signing-request.cjs.production.min.js.map
